<img src="https://griddb.org/brand-resources/griddb-logo/png/color.png" align="center" height="240" alt="GridDB"/>

# クラスタ運用管理コマンド・インタプリタ(gs_sh)

## 概要

クラスタ運用管理コマンド・インタプリタ(以降gs_shと記載します)は、GridDBクラスタの運用管理、およびデータ操作を提供するコマンドラインインターフェースツールです。

gs_shにより次のことができます。
-   GridDBクラスタの運用管理
    -   ステータス表示
-   GridDBクラスタのデータ操作
    -   データベース・ユーザ管理
    -   コレクション、トリガ表示
    -   索引設定、削除
    -   TQL/SQLによる検索

## gs_shを利用するには

### 事前準備

gs_shを利用するには、あらかじめ以下を実施ください。
-   GridDBのセットアップ
    -   GridDBノード、クライアントライブラリのインストール
    -   ユーザ作成
    -   ネットワーク設定（GridDBクラスタ定義ファイル、ノード定義ファイル）

    　※　手順の詳細に関しては、[GridDB クイックスタートガイド](https://github.com/griddb/docs-ja/blob/master/manuals/GridDB_QuickStartGuide/toc.md)を参照してください。

-   SSHによるリモート接続設定
    -   gs_sh実行環境から各GridDBノード実行環境へ、OSユーザ「gsadm」でSSH接続するための設定

    　※　SSH接続の手順の詳細に関しては、各OSのマニュアルを参照してください。

### gs_sh起動

gs_shには2種類の起動モードがあります。

- 対話モードで起動
  - gs_shを引数なしで実行すると、対話モードで起動されます。gs_shのプロンプトが表示され、サブコマンドの入力が可能になります。

    ``` example
    $ gs_sh
    //サブコマンド「version」の実行
    gs> version
    gs_sh version 2.0.0
    ```

- バッチモードで起動
  - gs_shにユーザ作成のスクリプトファイルを指定すると、バッチモードで起動されます。スクリプトファイルに記述した一連のサブコマンドをバッチ処理します。バッチ処理実行後に、gs_shは終了します。

    ``` example
    //スクリプトファイル(test.gsh)を指定して実行
    $ gs_sh test.gsh
    ```

【メモ】
- 対話モードでサブコマンドを起動すると、
  - 実行ユーザのホームディレクトリに.gssh_historyファイルが作成され、履歴が保存されます。
  - 矢印キーを押すと以前起動したサブコマンドを20個まで、表示/実行することができます。
  - サブコマンドの一部を入力しTabキーを押すと、サブコマンドの入力候補が一覧表示されます。
- gs_shは、OSユーザ「gsadm」で実行してください。
- gs_sh起動時に、gsadmユーザホームディレクトリ下の.gsshrcスクリプトファイルを自動的に読み込みます。.gsshrcの内容は、他のスクリプトファイルよりも先に読み込みます。
- スクリプトファイルの拡張子はgshです。
- スクリプトファイルは、文字コードUTF-8で記載します。

　

## GridDBクラスタの定義

GridDBクラスタの運用管理やデータ操作を実行するにあたり、事前に以下の定義が必要です。
- 各ノード情報を **ノード変数に定義**
- ノード変数を利用して、GridDBクラスタ構成を **クラスタ変数に定義**
- GridDBクラスタの **ユーザ情報を定義**

ノード変数、クラスタ変数、ユーザ情報の定義方法について、以下に説明します。また、任意の変数定義、変数定義内容の表示、変数定義内容のスクリプトファイルへの保存および読み込み方法についても説明します。

　

### ノード変数の定義

GridDBノードのIPアドレスとポート番号を、ノード変数に定義します。

- サブコマンド

  | |
  |-|
  | setnode  ノード変数名　IPアドレス　ポート番号　\[SSHポート番号\] |

- 引数

  | 引数          | 説明                                                                           |
  |---------------|--------------------------------------------------------------------------------|
  | ノード変数名  | ノード変数名を指定します。既に同じ変数名が存在する場合は、定義を上書きします。 |
  | IPアドレス    | GridDBノードのIPアドレス（運用管理ツール接続用）を指定します。                 |
  | ポート番号    | GridDBノードのポート番号（運用管理ツール接続用）を指定します。                 |
  | SSHポート番号 | SSHのポート番号を指定します。省略する場合は22番を使用します。                  |

- 例)

  ``` example
  //4つのGridDBノードを定義
  gs> setnode node0 192.168.0.1 10000
  gs> setnode node1 192.168.0.2 10000
  gs> setnode node2 192.168.0.3 10000
  gs> setnode node3 192.168.0.4 10000
  ```

【メモ】
- ノード変数名に利用できるのは半角英数字と記号"\_"のみです。
- 運用管理ツール接続用GridDBノード「IPアドレス」および「ポート番号」は、各ノードの **ノード定義ファイル** で確認してください。
  - IPアドレス：　/system/serviceAddress
  - ポート番号：　/system/servicePort

　　

### クラスタ変数の定義

GridDBクラスタの構成を、クラスタ変数に定義します。

- サブコマンド

  | | |
  |-|-|
  | マルチキャスト方式 | setcluster  &lt;クラスタ変数名&gt; &lt;クラスタ名&gt; &lt;マルチキャストアドレス&gt; &lt;ポート番号&gt; \[&lt;ノード変数&gt;...\] |
  | 固定リスト方式     | setcluster  &lt;クラスタ変数名&gt; &lt;クラスタ名&gt; FIXED_LIST &lt;固定リスト方式のアドレスリスト&gt; \[&lt;ノード変数&gt;...\] |
  | プロバイダ方式     | setcluster  &lt;クラスタ変数名&gt; &lt;クラスタ名&gt; PROVIDER &lt;プロバイダ方式のURL&gt; \[&lt;ノード変数&gt;...\]             |

- 引数

  | 引数                           | 説明                |
  |--------------------------------|-------------------------|
  | クラスタ変数名                 | クラスタ変数名を指定します。既に同じ変数名が存在する場合は、定義を上書きします。        |
  | クラスタ名                     | クラスタ名を指定します。                                                          |
  | マルチキャストアドレス         | \[マルチキャスト方式で指定する場合\] GridDBクラスタのマルチキャストアドレス（クライアント接続用）を指定します。    |
  | ポート番号                     | \[マルチキャスト方式で指定する場合\]GridDBクラスタのマルチキャストポート番号（クライアント接続用）を指定します。  |
  | ノード変数...                  | GridDBクラスタを構成するノードをノード変数で指定します。GridDBクラスタの運用管理操作を行わない場合、ノード変数の指定は省略可能です。               |
  | 固定リスト方式のアドレスリスト | \[固定リスト方式で指定する場合\] アドレスとポートのリストを指定します。例) 192.168.15.10:10001,192.168.15.11:10001 <br>クラスタ定義ファイル(gs_cluster.json)に設定されたクラスタ構成が固定リスト方式である場合、クラスタ定義ファイルの/cluster/notificationMemberのtransactionのアドレスとポートのリストを指定します。 |
  | プロバイダ方式のURL            | \[プロバイダ方式で指定する場合\] アドレスプロバイダのURLを指定します。<br>クラスタ定義ファイル(gs_cluster.json)に設定されたクラスタ構成がプロバイダ方式である場合、クラスタ定義ファイルの/cluster/notificationProvider/urlの値を指定します。        |

- 例)

  ``` example
  //GridDBクラスタ構成を定義
  gs> setcluster cluster0 name 200.0.0.1 1000 $node0 $node1 $node2
  ```

【メモ】
- クラスタ変数名に利用できるのは半角英数字と記号"\_"のみです。
- ノード変数を利用する際には、変数名の先頭に"$"をつけます。
- クラスタ変数に定義する「クラスタ名」、「マルチキャストアドレス」、「ポート番号」は、各GridDBノードのクラスタ定義ファイルで確認してください。
  - クラスタ名 ：　 /cluster/clusterName
  - マルチキャストアドレス：　 /transaction/notificationAddress
  - ポート番号 ：　 /transaction/notificationPort

    ※GridDBクラスタを構成するノードのクラスタ定義ファイルは、すべて同一の設定内容である必要があります。設定内容が異なる場合、クラスタを構成することはできません。

　

また、定義したクラスタ変数に対して、ノード変数の追加、削除を行うことができます。

- サブコマンド

  | |
  |-|
  | modcluster  クラスタ変数名　add\|remove　ノード変数... |

- 引数

  | 引数           | 説明                                                                              |
  |----------------|-----------------------------------------------------------------------------------|
  | クラスタ変数名 | ノードの追加、削除を行うクラスタ変数名を指定します。                              |
  | add\|remove    | ノード変数を追加する場合にはadd、ノード変数を削除する場合にはremoveを指定します。 |
  | ノード変数...  | クラスタ変数に追加、もしくは削除するノード変数を指定します。                      |

- 例)

  ``` example
  //定義済みのGridDBクラスタ構成にノードを追加
  gs> modcluster cluster0 add $node3
  //定義済みのGridDBクラスタ構成からノードを削除
  gs> modcluster cluster0 remove $node3
  ```

【メモ】
- ノード変数を利用する際には、変数名の先頭に"$"をつけます。

　

### クラスタのSQL接続先を定義

GridDBクラスタ構成にSQLの接続先を定義します。 **GridDB NewSQLインターフェースを使用する場合のみ設定します。**

- サブコマンド

  | | |
  |-|-|
  | マルチキャスト方式 | setclustersql &lt;クラスタ変数名&gt; &lt;クラスタ名&gt; &lt;SQLアドレス&gt; &lt;SQLポート番号&gt;             |
  | 固定リスト方式     | setclustersql &lt;クラスタ変数名&gt; &lt;クラスタ名&gt; FIXED_LIST &lt;固定リスト方式のSQLアドレスリスト&gt;   |
  | プロバイダ方式     | setclustersql &lt;クラスタ変数名&gt; &lt;クラスタ名&gt; PROVIDER &lt;プロバイダ方式のURL&gt;                  |

- 引数

  | 引数                              | 説明                                      |
  |-----------------------------------|-------------------------------------------------------------------------------------|
  | クラスタ変数名                    | クラスタ変数名を指定します。既に同じ変数名が存在する場合は、SQL接続情報を上書きします。      |
  | クラスタ名                        | クラスタ名を指定します。        |
  | SQLアドレス                       | \[マルチキャスト方式で指定する場合\] SQLクライアント接続用の受信アドレスを指定します。     |
  | SQLポート番号                     | \[マルチキャスト方式で指定する場合\] SQLクライアント接続用のポート番号を指定します。       |
  | 固定リスト方式のSQLアドレスリスト | \[固定リスト方式で指定する場合\] アドレスとポートのリストを指定します。 例) 192.168.15.10:20001,192.168.15.11:20001 <br>クラスタ定義ファイル（gs_cluster.json）に設定されたクラスタ構成が固定リスト方式である場合、クラスタ定義ファイルの/cluster/notificationMemberのsqlのアドレスとポートのリストを指定します。 |
  | プロバイダ方式のURL               | \[プロバイダ方式で指定する場合\] アドレスプロバイダのURLを指定します。<br>クラスタ定義ファイル(gs_cluster.json)に設定されたクラスタ構成がプロバイダ方式である場合、クラスタ定義ファイルの/cluster/notificationProvider/urlの値を指定します。            |

- 例)

  ``` example
  // NewSQLサーバに対して、NoSQLインターフェースとNewSQLインターフェースの両方を用いて接続する場合の定義方法
  gs> setcluster    cluster0 name 239.0.0.1 31999 $node0 $node1 $node2
  gs> setclustersql cluster0 name 239.0.0.1 41999
  ```

【メモ】
- クラスタ変数名に利用できるのは半角英数字と記号"\_"のみです。
- 既存のクラスタ変数名を指定するとSQL接続情報部分のみ上書きします。上書きする際は、既存の接続方式と同じ方式を指定する必要があります。
- SQLのみ使用する場合はこのコマンドだけ実行します。
- クラスタ変数に定義する「SQLアドレス」、「SQLポート番号」は、各GridDBノードのクラスタ定義ファイルで確認ください。
  - SQLアドレス ：　 /sql/notificationAddress
  - SQLポート番号 ：　 /sql/notificationPort

　

### ユーザの定義

GridDBクラスタにアクセスするユーザおよびパスワードを定義します。

- サブコマンド

  | |
  |-|
  | setuser  ユーザ名　パスワード|

- 引数

  | 引数             | 説明                                                                |
  |------------------|---------------------------------------------------------------------|
  | ユーザ名         | GridDBクラスタにアクセスするユーザ名を指定します。                  |
  | パスワード       | 対応するパスワードを指定します。                                    |

- 例)

  ``` example
  //GridDBクラスタにアクセスするユーザ、パスワードを定義
  gs> setuser admin admin
  ```

【メモ】
- ユーザ定義を行うと次の変数が定義されます。

  | 変数名     | 格納する情報    |
  |------------|-----------------|
  | user       | ユーザ名        |
  | password   | パスワード      |

- 複数ユーザは定義できません。後から定義したユーザ、パスワードで上書きします。gs_shで複数のGridDBクラスタを操作する場合には、接続先クラスタを変更する度にsetuserサブコマンドでユーザ、パスワードを再設定してください。

　　

### 任意の変数の定義

任意の変数を定義します。

- サブコマンド

  | |
  |-|
  | set 変数名　\[値\] |

- 引数

  | 引数   | 説明                                                                         |
  |--------|------------------------------------------------------------------------------|
  | 変数名 | 変数名を指定します。                                                         |
  | 値     | 設定値を指定します。指定を省略することで、当該変数の設定値をクリアできます。 |

- 例)

  ``` example
  //変数を定義
  gs> set GS_PORT 10000
  //変数の設定をクリア
  gs> set GS_PORT
  ```

【メモ】
- setサブコマンドにより、ノード変数やクラスタ変数の設定もクリアできます。
- 変数名に利用できるのは半角英数字と記号"\_"のみです。

　

### 変数定義の表示

指定した変数の定義内容を表示します。

- サブコマンド

  | |
  |-|
  | show \[変数名\] |

- 引数

  | 引数   | 説明                                                                                    |
  |--------|-----------------------------------------------------------------------------------------|
  | 変数名 | 定義内容を表示する変数名を指定します。指定を省略すると、すべての定義済み変数の内容を表示します。 |


- 例)

  ``` example
  //定義した全変数を定表示
  gs> show
  ノード変数:
    node0=Node[192.168.0.1:10000,ssh=22]
    node1=Node[192.168.0.2:10000,ssh=22]
    node2=Node[192.168.0.3:10000,ssh=22]
    node3=Node[192.168.0.4:10000,ssh=22]
  クラスタ変数:
    cluster0=Cluster[name=name,200.0.0.1:1000,nodes=(node0,node1,node2)]
  その他の変数:
    user=admin
    password=*****
    ospassword=*****
  ```

【メモ】
- パスワード文字列は表示しません。"\*\*\*"に置き換えて表示します。

　

### 変数定義のスクリプトファイル保存

変数に定義した内容をスクリプトファイルに保存します。

- サブコマンド

  | |
  |-|
  | save  \[スクリプトファイル名\] |

- 引数

  | 引数                 | 説明                                                                                |
  |----------------------|-------------------------------------------------------------------------------------|
  | スクリプトファイル名 | 保存先となるスクリプトファイル名を指定します。スクリプトファイルの拡張子はgshです。<br>指定を省略すると、gsadmユーザホームディレクトリの.gsshrcファイルに保存します。      |

- 例)

  ``` example
  //定義した変数をファイルに保存
  gs> save test.gsh
  ```

【メモ】
- 保存先スクリプトファイルが存在しない場合、ファイルを新規作成します。保存先スクリプトファイルが存在する場合、内容を上書きします。
- スクリプトファイルは、文字コードUTF-8で記載します。
- ユーザ定義に関する内容（ユーザ、パスワード、gsadmパスワード）はスクリプトファイルに出力しません。
- .gsshrcスクリプトファイルの内容は、gs_sh起動時に自動的に読み込みます。

　

### スクリプトファイルの実行

スクリプトファイルを読み込み、記載された処理を実行します。

- サブコマンド

  | |
  |-|
  | load \[スクリプトファイル名\] |

- 引数

  | 引数                 | 説明                                                                                 |
  |----------------------|--------------------------------------------------------------------------------------|
  | スクリプトファイル名 | 実行するスクリプトファイルを指定します。<br>指定を省略すると、gsadmユーザホームディレクトリの.gsshrcファイルを再度読み込みます。 |

- 例)

  ``` example
  //スクリプトファイルを実行
  gs> load test.gsh
  ```

【メモ】
- スクリプトファイルの拡張子はgshです。
- スクリプトファイルは、文字コードUTF-8で記載します。


### クラスタ変数とノード変数定義の同期

稼働中のGridDBクラスタに接続し、クラスタ変数とノード変数定義を自動で行います。

- サブコマンド

  | |
  |-|
  | sync IPアドレス ポート番号　\[クラスタ変数名 \[ノード変数\] \] |

- 引数

  | 引数                 | 説明                                                                                 |
  |----------------------|--------------------------------------------------------------------------------------|
  | IPアドレス | GridDBクラスタに参加している任意のGridDBノードのIPアドレスを指定します。 |
  | ポート番号 |GridDBノードのポート番号（運用管理ツール接続用）を指定します。 |
  | クラスタ変数名 | クラスタ変数名を指定します。<br>指定を省略した場合、クラスタ変数名は「scluster」です。 |
  | ノード変数名 | ノード変数名を指定します。<br>指定を省略した場合、ノード変数名は「snode+連番」です。 |

- 例)

  ``` example
  gs> sync 192.168.0.1 10040 mycluster mynode
 
  //設定を確認
  gs> show
  Node variable:
  mynode1=Node[192.168.0.1:10040,ssh=22]
  mynode2=Node[192.168.0.2:10040,ssh=22]
  mynode3=Node[192.168.0.3:10040,ssh=22]
  mynode4=Node[192.168.0.4:10040,ssh=22]
  mynode5=Node[192.168.0.5:10040,ssh=22]
  Cluster variable:
  mycluster=Cluster[name=mycluster,mode=MULTICAST,transaction=239.0.0.20:31999,sql=239.0.0.20:41999,nodes=($mynode1,$mynode2,$mynode3,$mynode4,$mynode5)]
  
  //設定を保存
  gs> save
  ```

【メモ】
- 本コマンドは管理者ユーザのみ実行できます。
- 変数名に利用できるのは半角英数字と記号"\_"のみです。
- gs_shを終了すると変数は破棄されます。saveサブコマンドで保存してください。
- 既存の変数名が存在する場合は、すべて上書きします。


## GridDBクラスタの運用管理操作

GridDBクラスタの運用を管理するための機能として、以下の操作を実行できます。
- 実行中SQL処理の表示
- 実行中イベントの表示
- コネクションの表示
- SQLキャンセル

### 実行中SQL処理の表示

実行中のSQL処理を表示します。

- サブコマンド

  | |
  |-|
  | showsql \[クエリID\] |

- 引数

  | 引数       | 説明                                         |
  |------------|----------------------------------------------|
  | クエリID   | 表示する対象のSQL処理を特定するIDです。<br>指定した場合は、指定したクエリIDのSQL処理情報のみ表示します。<br>未指定の場合は実行中のSQL処理の一覧を表示します。<br>クエリIDの値は実行中のSQL処理の表示にて取得できます。 |

- 表示項目
  - elapsed time： start timeの値とgs_shを実行している端末のシステム時刻より計算した経過時間です。単位は秒です。

- 例)
  ``` example
  gs[public]> showsql
  =======================================================================
  query id: e6bf24f5-d811-4b45-95cb-ecc643922149:3
  start time: 2019-04-02T06:02:36.939+09:00
  elapsed time: 53
  database name: public
  application name: gs_admin
  node: 192.168.56.101:10040
  sql: INSERT INTO TAB_711_0101 SELECT a.id, b.longval FROM TAB_711_0001 a LEFT OU
    job id: e6bf24f5-d811-4b45-95cb-ecc643922149:3:5:0
    node: 192.168.56.101:10040
  #---------------------------
  ```
【メモ】
- start timeはsettimezoneサブコマンドによるタイムゾーン設定が反映された値が表示されます。タイムゾーン未設定の場合はデフォルトのタイムゾーンの値が表示されます。

　
　
### 実行中イベントの表示

接続先クラスタの各ノード内のスレッドが実行中のイベント一覧を表示します。

- サブコマンド

  | |
  |-|
  | showevent |

- 表示項目
  - elapsed time： start timeの値とgs_shを実行している端末のシステム時刻より計算した経過時間です。単位は秒です。

- 例)

  ``` example
  gs[public]> showevent
  =======================================================================
  worker id: 0
  start time: 2019-03-05T05:28:21.000+09:00
  elapsed time: 1
  application name:
  node: 192.168.56.101:10040
  service type: TRANSACTION_SERVICE
  event type: PUT_MULTIPLE_ROWS
  cluster partition id: 5
  #---------------------------
  ```
【メモ】
- start timeはsettimezoneサブコマンドによるタイムゾーン設定が反映された値が表示されます。タイムゾーン未設定の場合はデフォルトのタイムゾーンの値が表示されます。

　

### コネクションの表示

コネクションの一覧を表示します。

- サブコマンド

  | |
  |-|
  | showconnection |

- 表示項目
  - elapsed time： creation timeの値とgs_shを実行している端末のシステム時刻より計算した経過時間です。単位は秒です。

- 例)

  ``` example
  gs[public]> showconnection
  =======================================================================
  application name: gs_admin
  creation time: 2019-04-02T06:09:42.523+09:00 service type: TRANSACTION
  elapsed time: 106 node: 192.168.56.101:10001 remote: 192.168.56.101:56166
  dispatching event count: 5 sending event count: 5
  #---------------------------
  ```
【メモ】
- creation timeはsettimezoneサブコマンドによるタイムゾーン設定が反映された値が表示されます。タイムゾーン未設定の場合はデフォルトのタイムゾーンの値が表示されます。

　

### SQLキャンセル

実行中のSQL処理をキャンセルします。

- サブコマンド

  | |
  |-|
  | killsql クエリID |

- 引数

  | 引数       | 説明                                         |
  |------------|----------------------------------------------|
  | クエリID   | キャンセルする対象のSQL処理を特定するIDです。<br>指定する値は実行中のSQL処理の表示にて取得できます。 |

- 例)

  ``` example
  gs[public]> killsql 5b9662c0-b34f-49e8-92e7-7ca4a9c1fd4d:1
  ```

【メモ】
- 管理ユーザのみが実行可能なコマンドです。

　

## データベース内のデータ操作

データ操作を実行するには、操作対象のクラスタに接続する必要があります。
接続時に設定したデータベース(データベース名省略時は「public」)のデータが操作対象になります。


### クラスタへ接続

データ操作を実行するGridDBクラスタに接続します。

- サブコマンド

  | |
  |-|
  | connect クラスタ変数 \[データベース名\] |

- 引数

  | 引数           | 説明                                                     |
  |----------------|----------------------------------------------------------|
  | クラスタ変数   | 接続先となるGridDBクラスタを、クラスタ変数で指定します。 |
  | データベース名 | データベース名を指定します。                             |

- 例)

  ``` example
  //GridDBクラスタに接続
  //NoSQLの場合
  gs> connect $cluster1
  接続に成功しました(NoSQL)。
  gs[public]>

  gs> connect $cluster1 userDB
  接続に成功しました(NoSQL)。
  gs[userDB]>

  //NewSQLの場合（NoSQL/NewSQLインターフェースの両方を設定)
  gs> connect $cluster1
  接続に成功しました(NoSQL)。
  接続に成功しました(NewSQL)。
  gs[public]>
  ```

【メモ】
- データベース名が指定されていると、そのデータベースに接続します。データベース名省略時は「public」データベースに接続します。
- connectが成功するとプロンプトに接続先データベース名が表示されます。
- クラスタ変数を利用する際には、変数名の先頭に"$"をつけます。
- データ操作サブコマンドを実行する場合、GridDBクラスタに接続する必要があります。
- SQL接続先が指定されている場合(setclustersqlサブコマンドの実行)は、SQL接続も行われます。
- connectサブコマンド実行後に、settimezoneサブコマンドでタイムゾーン設定を変更した場合、変更後のタイムゾーン設定は再度、connectサブコマンドを実行するまで反映されません。タイムゾーン設定変更を行った後には再度、connectサブコマンドを実行してください。

　

### 検索 (TQL)

検索を実行し、検索結果を保持します。

- サブコマンド

  | |
  |-|
  | tql コンテナ名　クエリ ; |

- 引数

  | 引数       | 説明                                                                |
  |------------|---------------------------------------------------------------------|
  | コンテナ名 | 検索対象となるコンテナを指定します。                                |
  | クエリ　;  | 実行するTQL文を指定します。TQL文の最後にはセミコロン(;)が必要です。 |

- 例)

  ``` example
  //検索を実行
  gs[public]> tql c001 select *;
  5 件ヒットしました。(25 ms)
  ```

【メモ】
- データ操作サブコマンドを実行する場合、GridDBクラスタに接続する必要があります。
- TQL文の途中に改行を挿入可能です。
- 検索の実行時間がミリ秒で表示されます。
- 最新の検索結果を保持します。検索結果は、tqlまたはsqlサブコマンド実行時に破棄します。
- TQLの詳細に関しては、[GridDB TQLリファレンス](https://github.com/griddb/docs-ja/blob/master/manuals/GridDB_TQL_Reference/toc.md)の「TQL構文・演算機能」の章を参照してください。

　

### SQL文実行

SQL文を実行し、検索結果を保持します。 

- サブコマンド

  | |
  |-|
  | sql SQL文 ; |

- 引数

  | 引数     | 説明                                                                |
  |----------|---------------------------------------------------------------------|
  | SQL文 ; | 実行するSQL文を指定します。SQL文の最後にはセミコロン(;)が必要です。 |

- 例)

  ``` example
  gs[public]> sql select * from con1;          → SQLの検索
  10,000 件ヒットしました。(52 ms)
  gs[public]> get 1                            → SQLの結果表示
  id,name
  ----------------------
  0,tanaka
  1 件の取得が完了しました。
  ```

　

SQL文の先頭が下記文字列のいずれかである場合、サブコマンド名sqlを省略することができます。
-   select update insert replace delete create drop alter grant revoke pragma explain

【メモ】
- sqlサブコマンド実行前に、SQL接続先を指定して接続connectを行っている必要があります。
- 最新の検索結果を保持します。検索結果は、sqlまたはtqlサブコマンド実行時に破棄します。
- set password構文や先頭にコメントを含むSQL文の場合、サブコマンド名sqlは省略できません。
- 検索時、ヒット件数の取得処理が行われます。
- 検索の実行時間がミリ秒で表示されます。ヒット件数の取得にかかる時間は含まれません。
- SQL文の種類により、以下のように結果が表示されます。

  | 処理                       | 正常終了時の実行結果                                                                  |
  |----------------------------|---------------------------------------------------------------------------------------|
  | 検索　SELECT               | 検索結果の件数を表示します。検索結果はサブコマンドget/getcsv/getnoprintで表示します。 |
  | 更新　INSERT/UPDATE/DELETE | 更新したロウ数を表示します。                                                          |
  | DDL文                      | 何も表示されません。                                                                  |

- SQLの詳細に関しては、[GridDB SQLリファレンス](https://github.com/griddb/docs-ja/blob/master/manuals/GridDB_SQL_Reference/toc.md)を参照してください。

　

### 検索結果の取得

保持する検索結果から、指定件数を取得します。結果の出力方法には以下の３種類があります。


(A) 取得した結果を標準出力に表示します。

- サブコマンド

  | |
  |-|
  | get \[取得件数\] |

- 引数

  | 引数     | 説明                                                                             |
  |----------|----------------------------------------------------------------------------------|
  | 取得件数 | 検索結果の取得件数を指定します。省略すると、全ての検索結果を取得して表示します。 |


(B) 取得した結果をCSV形式でファイルに保存します。

- サブコマンド

  | |
  |-|
  | getcsv CSVファイル名　\[取得件数\] |

- 引数

  | 引数       | 説明                                                                                       |
  |------------|--------------------------------------------------------------------------------------------|
  | CSVファイル名 | 検索結果を保存するCSVファイル名を指定します。                                                 |
  | 取得件数   | 検索結果の取得件数を指定します。省略すると、全ての検索結果を取得してファイルに保存します。 |


(C) 取得した結果を出力しません。

- サブコマンド

  | |
  |-|
  | getnoprint \[取得件数\] |

- 引数

  | 引数     | 説明                                                                     |
  |----------|--------------------------------------------------------------------------|
  | 取得件数 | 検索結果の取得件数を指定します。省略すると、全ての検索結果を取得します。 |


例)

  ``` example
  //検索を実行
  gs[public]> tql c001 select *;
  5 件ヒットしました。

  //1件目を取得して表示
  gs[public]> get 1
  name,status,count
  mie,true,2
  1 件の取得が完了しました。

  //2～3件目を取得してファイルに保存
  gs[public]> getcsv /var/lib/gridstore/test2.csv 2
  2 件の取得が完了しました。

  //4件目を取得
  gs[public]> getnoprint 1
  1 件の取得が完了しました。

  //5件目を取得して表示
  gs[public]> get 1
  name,status,count
  akita,true,45
  1 件の取得が完了しました。
  ```

【メモ】
- データ操作サブコマンドを実行する場合、GridDBクラスタに接続する必要があります。
- 検索結果の１行目には、列名を出力します。
- 検索未実行、検索結果の全件取得、もしくは検索結果の破棄後に、検索結果の取得を行うとエラーとなります。
- NULL値はコマンドによってそれぞれ以下のように出力されます。
  - get: (NULL)
  - getcsv: 引用符のない空文字
- TIMESTAMP型のカラム値は次の形式で出力されます。
  - 時刻フォーマット: ISO8601形式
  - タイムゾーン: settimezoneサブコマンドによるタイムゾーン設定値 未設定の場合はUTC
  - 例: 2018-11-07T12:30:00.417Z、2019-05-01T09:30:00.000+09:00

　

### 実行計画の取得

指定TQL文の実行計画を表示します。検索は実行しません。

- サブコマンド

  | |
  |-|
  | tqlexplain コンテナ名　クエリ ; |

- 引数

  | 引数       | 説明                                                                          |
  |------------|-------------------------------------------------------------------------------|
  | コンテナ名 | 対象となるコンテナを指定します。                                              |
  | クエリ　;  | 実行計画を取得するTQL文を指定します。TQL文の最後にはセミコロン(;)が必要です。 |

- 例)

  ``` example
  //実行計画を取得
  gs[public]> tqlexplain c001 select * ;
  0       0       SELECTION       CONDITION       NULL
  1       1       INDEX   BTREE   ROWMAP
  2       0       QUERY_EXECUTE_RESULT_ROWS       INTEGER 0
  ```

また、指定TQL文を実際に実行して、実行計画とともに処理行数等の実測値を表示することもできます。

- サブコマンド

  | |
  |-|
  | tqlanalyze コンテナ名　クエリ　; |

- 引数

  | 引数       | 説明                                                                          |
  |------------|-------------------------------------------------------------------------------|
  | コンテナ名 | 対象となるコンテナを指定します。                                              |
  | クエリ　;  | 実行計画を取得するTQL文を指定します。TQL文の最後にはセミコロン(;)が必要です。 |

- 例)

  ``` example
  //検索を実行して実行計画を取得
  gs[public]> tqlanalyze c001 select *;
  0       0       SELECTION       CONDITION       NULL
  1       1       INDEX   BTREE   ROWMAP
  2       0       QUERY_EXECUTE_RESULT_ROWS       INTEGER 5
  3       0       QUERY_RESULT_TYPE       STRING  RESULT_ROW_ID_SET
  4       0       QUERY_RESULT_ROWS       INTEGER 5
  ```

【メモ】
- データ操作サブコマンドを実行する場合、GridDBクラスタに接続する必要があります。
- 検索結果は保持しないため、検索結果の取得はできず、tqlcloseサブコマンド実行の必要もありません。検索結果が必要な場合は、tqlサブコマンドでクエリを実行してください。
- パーティションテーブル(コンテナ)は非対応です。実行した場合はエラーとなります。

　

### 検索結果の破棄

tqlをクローズして、保持する検索結果を破棄します。
- サブコマンド

  | |
  |-|
  | tqlclose |

クエリをクローズして、保持する検索結果を破棄します。
- サブコマンド

  | |
  |-|
  | queryclose |

例)

  ``` example
  //検索結果を破棄
  gs[public]> tqlclose

  gs[public]> queryclose
  ```

【メモ】
- 検索結果は、下記のタイミングで破棄されます。
  - tqlclose　または　querycloseサブコマンド実行時
  - tqlまたはsqlサブコマンドによる新規検索実行時
  - disconnectサブコマンドによるGridDBクラスタからの切断時
- 検索結果の破棄後に検索結果の取得（getサブコマンドなど）を行うとエラーとなります。

　

### クラスタから切断

GridDBクラスタから切断します。

- サブコマンド

  | |
  |-|
  | disconnect |

- 例)

  ``` example
  //GridDBクラスタから切断
  gs[public]> disconnect
  gs>
  ```

【メモ】
- 保持している検索結果は破棄します。
- 切断すると、プロンプトの接続データベース名の表示が無くなります。

　

### 件数取得の設定

SQLの検索実行時、件数取得処理を実行するかどうかを設定します。

- サブコマンド

  | |
  |-|
  | sqlcount boolean |

- 引数

  | 引数    | 説明                       |
  |---------|--------------------------------------------------------------------------------------------------------------------------------------|
  | boolean | FALSEを指定するとsqlサブコマンドによる検索時に件数取得処理を実行しません。また、ヒット件数も表示されなくなります。既定値はTRUEです。 |

- 例)

  ``` example
  gs[public]> sql select * from mycontainer;
  25550 件ヒットしました。(33 ms)

  gs[public]> sqlcount FALSE

  gs[public]> sql select * from mycontainer;
  検索を実行しました。(33 ms)
  ```

【メモ】
- FALSEを指定した場合、検索時のヒット件数が表示されない代わりにレスポンスが早くなります。なお、表示される実行時間には影響しません。

　

## コンテナ管理

コンテナへの操作を実行するサブコマンドについて説明します。 コンテナ管理は、操作対象のクラスタに接続してから実行してください(サブコマンド connect)。 接続先のデータベース上のコンテナが操作対象になります。

### コンテナ作成

コンテナを作成します。

- サブコマンド（簡易版）

  | | |
  |-|-|
  | コンテナ(コレクション)  | createcollection コンテナ名　カラム名　タイプ　\[カラム名　タイプ …\] |
  | コンテナ(時系列コンテナ) | createtimeseries コンテナ名　圧縮方式　カラム名　タイプ　\[カラム名　タイプ …\] |

- 各引数の説明

  | 引数                 | 説明                                                 |
  |----------------------|-----------------------------------------------------|
  | コンテナ名           | 作成するコンテナの名前を指定します。|
  | カラム名             | カラム名を指定します。                                 |
  | タイプ               | カラムのタイプを指定します。                           |
  | 圧縮方式             | 時系列データの場合、データの圧縮方式を指定します。       |

　

**簡易版**

コンテナ名とカラム情報（カラム名とタイプ）を指定してコンテナを作成します。コンテナタイプが時系列コンテナの場合のみ、圧縮タイプの指定も可能です。

- 圧縮方式は、"NO", "SS"を指定します。"HI"を指定する場合は、APIを利用してください。
- コレクションは、ロウキー指定ありで作成されます。第一カラムがロウキーになります。
- 複合ロウキー、複合索引、カラム制約、索引名を指定する場合は、SQLを利用してください。

　

### コンテナ削除

コンテナを削除します。

- サブコマンド

  | |
  |-|
  | dropcontainer コンテナ名 |

- 引数

  | 引数       | 説明                                 |
  |------------|--------------------------------------|
  | コンテナ名 | 削除するコンテナの名前を指定します。 |

- 例)
  ``` example
  gs[public]> dropcontainer　Con001
  ```

【メモ】
- パーティションテーブル(コンテナ)は非対応です。実行した場合はエラーとなります。
  - パーティションテーブル(コンテナ)の削除にはSQLを使用してください。


### ロウ登録

コンテナにロウを登録します。

- サブコマンド

  | |
  |-|
  | putrow コンテナ名 値 [値...]|

- 引数

  | 引数       | 説明                                 |
  |------------|--------------------------------------|
  | コンテナ名 | ロウを登録するコンテナの名前を指定します。 |
  | 値 | 登録するロウの値を指定します。 |
  
- 例)
  ``` example
  gs[public]> putrow mycontainer 'key1' 1 1.0
  gs[public]> putrow mycontainer 'key2' 2 2.0
  gs[public]> putrow mycontainer 'key3' 3 null

  //結果確認
  gs[public]> tql mycontainer select *;
  3 results. (1 ms)

  gs[public]> get
  key,val1,val2
  key1,1,1.0
  key2,2,2.0
  key3,3,(NULL)
  3 results had been acquired.
  ```


### ロウ削除

コンテナのロウを削除します。

- サブコマンド

  | |
  |-|
  | removerow コンテナ名 ロウキー値 [ロウキー値...]|

- 引数

  | 引数       | 説明                                 |
  |------------|--------------------------------------|
  | コンテナ名 | ロウを削除するコンテナの名前を指定します。 |
  | 値 | 削除するロウのロウキー値を指定します。 |
  
- 例)
  ``` example
  gs[public]> removerow mycontainer 'key1'
  gs[public]> removerow mycontainer 'key2'

  //結果確認
  gs[public]> tql mycontainer select *;
  1 results. (1 ms)
  
  gs[public]> get
  key,val1,val2
  key3,3,(NULL)
  1 results had been acquired.
  ```

【メモ】
- 複合ロウキーが設定されたコンテナの場合、すべてのロウキーを指定する必要があります。


### コンテナの表示

コンテナ情報を表示します。

- サブコマンド

  | |
  |-|
  | showcontainer \[コンテナ名\] |

- 引数

  | 引数       | 説明                                                                               |
  |------------|------------------------------------------------------------------------------------|
  | コンテナ名 | 表示対象のコンテナ名を指定します。省略した場合、全てのコンテナの一覧を表示します。 |


- 例)

  ``` example
  //コンテナ一覧を表示
  gs[public]> showcontainer
  Database : public
  Name                 Type        PartitionId
  ---------------------------------------------
  TEST_TIME_0001       TIME_SERIES           3
  TEST_TIME_0004       TIME_SERIES          12
  TEST_TIME_0005       TIME_SERIES          26
  cont003              COLLECTION           27
  TABLE_01             COLLECTION           58
  TEST_COLLECTION_0001 COLLECTION           79

  //指定コンテナの情報を表示
  gs[public]> showcontainer cont003
  Database    : public
  Name        : cont003
  Type        : COLLECTION
  Partition ID: 27
  DataAffinity: -
  
  Columns:
  No  Name                  Type            CSTR  RowKey
  ------------------------------------------------------------------------------
   0  col1                  INTEGER         NN    [RowKey]
   1  col2                  STRING
   2  col3                  TIMESTAMP
  
  Indexes:
  Name        :
  Type        : TREE
  Columns:
  No  Name
  --------------------------
   0  col1
  
  Name        :
  Type        : HASH
  Columns:
  No  Name
  --------------------------
   0  col2
  
  Name        : myIndex
  Type        : TREE
  Columns:
  No  Name
  --------------------------
   0  col2
   1  col3
  ```

【メモ】
- カレントデータベースのコンテナ情報が表示されます。
- コンテナ一覧で表示するのは、「コンテナ名」、「コンテナタイプ」、「パーティションID」です。
- 指定コンテナの情報で表示するのは、「コンテナ名」、「コンテナタイプ」、「パーティションID」、「定義したカラム名」、「カラムのデータ型」、「カラム制約(CSTR)」、「索引情報」、「テーブルパーティショニング情報」です。
- 「カラム制約(CSTR)」には、NOT NULL制約(NN)の有無が表示されます。
- 「テーブルパーティショニング情報」は、JDBC接続されている場合は詳細な情報が表示されます。表示される項目は、「パーティショニングの種別」(Partition Type)、「パーティショニングキーのカラム名」(Partition Column)、さらに、インターバルの場合は「分割幅値」(Partition Interval Value)「単位」(Partition Interval Unit)、ハッシュの場合は「分割数」(Partition Division Count)です。インターバル-ハッシュパーティショニングの場合は、インターバルとハッシュのそれぞれについて各項目が表示されます。


- 例)
  ``` example
  //指定コンテナの情報を表示 (JDBC接続されている場合)
  gs[userDB]> showcontainer time018
  Database    : userDB
  Name        : time018
  Type        : TIME_SERIES
  Partition ID: 37
  DataAffinity: -
  Partitioned : true
  Partition Type           : INTERVAL
  Partition Column         : date
  Partition Interval Value : 730
  Partition Interval Unit  : DAY
  Sub Partition Type           : HASH
  Sub Partition Column         : date
  Sub Partition Division Count : 16
        :
        :

  //指定コンテナの情報を表示 (JDBC接続されていない場合)
  gs[userDB]> showcontainer time018
  Database    : userDB
  Name        : time018
  Type        : TIME_SERIES
  Partition ID: 37
  DataAffinity: -
  Partitioned : true (need SQL connection for details)
        :
        :
  ```

　

### テーブルの表示

テーブル情報を表示します。showcontainerとの互換コマンドです。

- サブコマンド

  | |
  |-|
  | showtable \[テーブル名\] |

- 引数

  | 引数       | 説明                                                                               |
  |------------|------------------------------------------------------------------------------------|
  | テーブル名 | 表示対象のテーブル名を指定します。省略した場合、全てのテーブルの一覧を表示します。 |

　
### コンテナの検索

コンテナ名からコンテナを検索します。

- サブコマンド

  | |
  |-|
  | searchcontainer  \[コンテナ名\] |

- 引数

  | 引数       | 説明                                                                               |
  |------------|------------------------------------------------------------------------------------|
  | コンテナ名 | 検索対象のコンテナ名を指定します。指定しない場合、すべてのコンテナを表示します。また、コンテナ名にワイルドカード（「%」は任意の0文字以上、「_」は任意の一文字）が指定できます。 |

- 例)
  ``` example
  gs[public]> searchcontainer mycontainer
  mycontainer
  
  gs[public]> searchcontainer my%
  my
  my_container
  mycontainer

  gs[public]> searchcontainer my\_container
  my_container
  ```

### ビューの検索

ビュー名からビューを検索します。

- サブコマンド

  | |
  |-|
  | searchview  \[ビュー名\] |

- 引数

  | 引数       | 説明                                                                               |
  |------------|------------------------------------------------------------------------------------|
  | ビュー名 | 検索対象のビュー名を指定します。指定しない場合、すべてのビューを表示します。また、ビュー名にワイルドカード（「%」は任意の0文字以上、「_」は任意の一文字）が指定できます。 |

- 例)
  ``` example
  gs[public]> searchview myview
  myview
  
  gs[public]> searchview my%
  my
  my_view
  myview

  gs[public]> searchview my\_view
  my_view
  ```

### 索引の作成

指定したコンテナのカラムに索引を作成します。

- サブコマンド

  | |
  |-|
  | createindex コンテナ名　カラム名　索引タイプ... |

- 引数

  | 引数          | 説明                                                                                          |
  |---------------|-----------------------------------------------------------------------------------------------|
  | コンテナ名    | 索引操作対象のカラムが所属するコンテナ名を指定します。                                        |
  | カラム名      | 索引操作対象のカラム名を指定します。                                                          |
  | 索引タイプ... | 索引タイプを指定します。索引タイプはTREE、HASH、SPATIALのいずれか（または複数）を指定します。 |

- 例)

  ``` example
  //索引の作成
  gs[public]> createindex cont003 col2 tree hash

  gs[public]> showcontainer cont003
  Database    : public
  Name        : cont003
  Type        : COLLECTION
  Partition ID: 27
  DataAffinity: -

  Columns:
  No  Name                  Type            CSTR  RowKey
  ------------------------------------------------------------------------------
   0  col1                  INTEGER         NN    [RowKey]
   1  col2                  STRING                
   2  col3                  TIMESTAMP             

  Indexes:
  Name        : 
  Type        : TREE
  Columns:
  No  Name                  
  --------------------------
   0  col1

  Name        : 
  Type        : TREE
  Columns:
  No  Name                  
  --------------------------
   0  col2

  Name        : 
  Type        : HASH
  Columns:
  No  Name                  
  --------------------------
   0  col2
  ```

【メモ】
- 作成済みの索引を指定しても、エラーは発生しません。
- 索引名は未対応です。索引名を付加する場合は、SQLを使用してください。

　

### 複合索引の作成

指定したコンテナのカラムに複合索引を作成します。

- サブコマンド

  | |
  |-|
  | createcompindex コンテナ名　カラム名... |

- 引数

  | 引数          | 説明                                                                                          |
  |---------------|-----------------------------------------------------------------------------------------------|
  | コンテナ名    | 索引操作対象のカラムが所属するコンテナ名を指定します。                                        |
  | カラム名      | 索引操作対象のカラム名を指定します。複数指定します。                                          |

- 例)

  ``` example
  //索引の作成
  gs[public]> createcompindex cont003 col2 col3

  gs[public]> showcontainer cont003
  Database    : public
  Name        : cont003
  Type        : COLLECTION
  Partition ID: 27
  DataAffinity: -
  
  Columns:
  No  Name                  Type            CSTR  RowKey
  ------------------------------------------------------------------------------
   0  col1                  INTEGER         NN    [RowKey]
   1  col2                  STRING
   2  col3                  TIMESTAMP
  
  Indexes:
  Name        :
  Type        : TREE
  Columns:
  No  Name
  --------------------------
   0  col1
  
  Name        :
  Type        : TREE
  Columns:
  No  Name
  --------------------------
   0  col2
   1  col3
  ```
【メモ】
- 作成済みの索引を指定しても、エラーは発生しません。
- 索引名は未対応です。索引名を付加する場合は、SQLを使用してください。
- パーティションテーブルに対する操作は非対応です。コンテナ名にパーティションテーブルを指定した場合はエラーとなります。

　

### 索引の削除

指定したコンテナのカラムの索引を削除します。

- サブコマンド

  | |
  |-|
  | dropindex コンテナ名　カラム名　索引タイプ... |

- 引数

  | 引数          | 説明                                                                                          |
  |---------------|-----------------------------------------------------------------------------------------------|
  | コンテナ名    | 索引操作対象のカラムが所属するコンテナ名を指定します。                                        |
  | カラム名      | 索引操作対象のカラム名を指定します。                                                          |
  | 索引タイプ... | 索引タイプを指定します。索引タイプはTREE、HASH、SPATIALのいずれか（または複数）を指定します。 |

- 例)

  ``` example
  //索引の削除
  gs[public]> showcontainer cont004
  Database    : public
  Name        : cont004
      :
      :
  Indexes:
  Name        : 
  Type        : TREE
  Columns:
  No  Name                  
  --------------------------
   0  id

  Name        : myIndex
  Type        : TREE
  Columns:
  No  Name                  
  --------------------------
   0  value

  gs[public]> dropindex cont004 value tree
  gs[public]> showcontainer cont004
  Database    : public
  Name        : cont004
      :
      :
  Indexes:
  Name        : 
  Type        : TREE
  Columns:
  No  Name                  
  --------------------------
   0  id
  ```

【メモ】
- 作成されていない索引を指定しても、エラーは発生しません。

　

### 複合索引の削除

指定したコンテナのカラムの複合索引を削除します。

- サブコマンド

  | |
  |-|
  | dropcompindex コンテナ名　カラム名... |

- 引数

  | 引数          | 説明                                                                                          |
  |---------------|-----------------------------------------------------------------------------------------------|
  | コンテナ名    | 索引操作対象のカラムが所属するコンテナ名を指定します。                                        |
  | カラム名      | 索引操作対象のカラム名を指定します。複数指定します。                                          |

- 例)

  ``` example
  //索引の削除
  gs[public]> showcontainer cont003
  Database    : public
  Name        : cont003
  Type        : COLLECTION
  Partition ID: 27
  DataAffinity: -
  
  Columns:
  No  Name                  Type            CSTR  RowKey
  ------------------------------------------------------------------------------
   0  col1                  INTEGER         NN    [RowKey]
   1  col2                  STRING
   2  col3                  TIMESTAMP
  
  Indexes:
  Name        :
  Type        : TREE
  Columns:
  No  Name
  --------------------------
   0  col1
  
  Name        :
  Type        : TREE
  Columns:
  No  Name
  --------------------------
   0  col2
   1  col3

  gs[public]> dropcompindex cont003 col2 col3

  gs[public]> showcontainer cont003
  Database    : public
  Name        : cont003
  Type        : COLLECTION
  Partition ID: 27
  DataAffinity: -
  
  Columns:
  No  Name                  Type            CSTR  RowKey
  ------------------------------------------------------------------------------
   0  col1                  INTEGER         NN    [RowKey]
   1  col2                  STRING
   2  col3                  TIMESTAMP
  
  Indexes:
  Name        :
  Type        : TREE
  Columns:
  No  Name
  --------------------------
   0  col1
  ```

【メモ】
- 作成されていない索引を指定しても、エラーは発生しません。
- パーティションテーブルに対する操作は非対応です。コンテナ名にパーティションテーブルを指定した場合はエラーとなります。

　

### トリガの削除

指定したコンテナのトリガを削除します。

- サブコマンド

  | |
  |-|
  | droptrigger コンテナ名 トリガ名 |

- 引数

  | 引数     | 説明                                     |
  |----------|------------------------------------------|
  | コンテナ名 | 削除するトリガのコンテナ名を指定します。 |
  | トリガ名 | 削除するトリガ名を指定します。           |

- 例)
  ``` example
  gs[public]> droptrigger con01 tri03
  ```

　

### トリガの表示

指定したコンテナのトリガ情報を表示します。

- サブコマンド

  | |
  |-|
  | showtrigger コンテナ名　\[トリガ名\] |

- 引数

  | 引数     | 説明                                                                               |
  |----------|------------------------------------------------------------------------------------|
  | コンテナ名 | 表示対象のコンテナ名を指定します。                                                 |
  | トリガ名 | 表示対象のトリガ名を指定します。省略した場合、全てのトリガ情報の一覧を表示します。 |

- 例)

  ``` example
  //指定コンテナのトリガ情報一覧を表示
  gs[public]> showtrigger cont003
  Name                 Type  Columns              Events
  ---------------------------------------------------------------
  rtrig01              REST  [col1, col3]         [PUT]

  gs[public]> showtrigger cont003 rtrig01
  Name          : rtrig01
  Type          : REST
  Target Columns: [col1, col3]
  Target Events : [PUT]

  Destination URI: http://example.com
  ```

【メモ】
- トリガ一覧で表示するのは、「トリガ名」、「通知方法」、「通知対象カラム」、「監視対象操作(ロウの新規作成または更新、削除)」です。
- 指定トリガ情報で表示するのは、「トリガ名」、「通知方法」、「通知対象カラム」、「監視対象操作」、「通知先URI」を表示します。また、JMS通知の場合には、「ディスティネーション名」、「ディスティネーションタイプ」、「ユーザ」、「パスワード」も合わせて表示します。
- トリガ機能の詳細に関しては、[GridDB 機能リファレンス](https://github.com/griddb/docs-ja/blob/master/manuals/GridDB_FeaturesReference/toc.md)の「トリガ機能」の節を参照してください。

　

## 実行計画

SQL実行計画を表示するサブコマンドについて説明します。

### SQL分析結果(グローバルプラン)の取得

SQL分析結果(グローバルプラン)をテキスト形式またはJSON形式で表示します。

#### テキスト形式

- サブコマンド

  | |
  |-|
  | getplantxt \[テキストファイル名\] |

- 引数

  | 引数              | 説明                                  |
  |------------------|---------------------------------------|
  | テキストファイル名 | 結果を保存するファイル名を指定します。   |

- 例)

  ``` example
  gs[public]> getplantxt
  Id Type         Input Rows Lead time Actual time Node                 And more..
  -----------------------------------------------------------------------------------------------------------------
   0 SCAN         -     -            0           0 192.168.56.101:10001 table: {collection_nopart_AA22} INDEX SCAN
   1 SCAN         -     -            0           0 192.168.56.101:10001 table: {collection_nopart_AA23}
   2   JOIN       0,1   1,10         1           1 192.168.56.101:20001 JOIN_EQ_HASH
   3   SCAN       -     -            0           0 192.168.56.101:10001 table: {collection_nopart_AA24}
   4     JOIN     2,3   1,10         4           1 192.168.56.101:20001 JOIN_EQ_HASH
   5       RESULT 4     1            0           0 192.168.56.101:20001           
  ```

【メモ】
- 事前にEXPLAINまたはEXPLAIN ANALYZEが実行されていない場合はエラーとなります。
- 表示内容
  - ID: プランID
  - Type: 処理の種類
  - Input: 入力値となるプランのプランID
  - Rows: 入力件数
  - Lead time: 処理時間
  - Actual time: 処理のためにスレッドが占有された時間
  - Node: 処理が実施されたノード

#### JSON形式

- サブコマンド

  | |
  |-|
  | getplanjson \[JSONファイル名\] |

- 引数

  | 引数              | 説明                                  |
  |------------------|---------------------------------------|
  | JSONファイル名 | 結果を保存するファイル名を指定します。   |


- 例)
  ``` example
  gs[public]> getplanjson
  {
    "nodeList" : [ {
      "cmdOptionFlag" : 65,
      "id" : 0,
      "indexInfoList" : [ 2, 0, 0 ],
      "inputList" : [ ],
      "outputList" : [ {
        "columnId" : 0,
        "columnType" : "STRING",
        "inputId" : 0,
        "op" : "EXPR_COLUMN",
        "qName" : {
          "db" : "public",
          "name" : "id",
          "table" : "collection_nopart_AA22"
        },
        "srcId" : 1
      }, {
  ・
  ・
  ・
  ```

【メモ】
- 事前にEXPLAINまたはEXPLAIN ANALYZEが実行されていない場合はエラーとなります。

### SQL分析結果詳細情報の取得

SQL分析結果の詳細情報をJSON形式で表示します。

- サブコマンド

  | |
  |-|
  | gettaskplan プランID |

- 引数

  | 引数              | 説明                                  |
  |------------------|---------------------------------------|
  | プランID | 表示する対象のプランIDを指定します。   |


- 例)
  ``` example
  gs[public]> gettaskplan 0
  {
    "cmdOptionFlag" : 65,
    "id" : 0,
    "indexInfoList" : [ 2, 0, 0 ],
    "inputList" : [ ],
    "outputList" : [ {
      "columnId" : 0,
      "columnType" : "STRING",
      "inputId" : 0,
      "op" : "EXPR_COLUMN",
      "qName" : {
        "db" : "public",
        "name" : "id",
        "table" : "collection_nopart_AA22"
      },
      "srcId" : 1
    }, {
  ・
  ・
  ・
  ```

【メモ】
- 事前にEXPLAINまたはEXPLAIN ANALYZEが実行されていない場合はエラーとなります。

## その他の操作

その他のサブコマンドについて説明します。

### エコーバック設定

実行したサブコマンドを標準出力に表示します。

- サブコマンド

  | |
  |-|
  | echo boolean |

- 引数

  | 引数    | 説明                                                                              |
  |---------|-----------------------------------------------------------------------------------|
  | boolean | TRUEを指定すると、実行したサブコマンドを標準出力に表示します。既定値はFALSEです。 |

- 例)

  ``` example
  //実行したサブコマンドを標準出力に表示
  gs> echo TRUE
  ```

【メモ】
- gs_shのプロンプト"gs&gt;"は常に標準出力に表示します。

　

### メッセージの表示

指定した文字列、もしくは変数の定義内容を表示します。

- サブコマンド

  | |
  |-|
  | print メッセージ |

- 引数

  | 引数       | 説明                                     |
  |------------|------------------------------------------|
  | メッセージ | 表示する文字列もしくは変数を指定します。 |

- 例)

  ``` example
  //文字列の表示
  gs> print printを実行しました。
  printを実行しました。
  ```

【メモ】
- 変数を利用する際には、変数名の先頭に"$"をつけます。

　

### スリープ

指定した秒数スリープします。

- サブコマンド

  | |
  |-|
  | sleep 秒数 |

- 引数

  | 引数 | 説明                           |
  |------|--------------------------------|
  | 秒数 | スリープする秒数を指定します。 |

- 例)

  ``` example
  //10秒間スリープ
  gs> sleep 10
  ```

【メモ】
- 秒数は正の整数を指定してください。

　

### 外部コマンドの実行

外部コマンドを実行します。

- サブコマンド

  | |
  |-|
  | exec 外部コマンド　\[外部コマンド引数\] |

- 引数

  | 引数             | 説明                             |
  |------------------|----------------------------------|
  | 外部コマンド     | 外部コマンドを指定します。       |
  | 外部コマンド引数 | 外部コマンドの引数を指定します。 |

- 例)

  ``` example
  //カレントディレクトリのファイル情報を表示
  gs> exec ls -la
  ```

【メモ】
- パイプ、リダイレクト、ヒアドキュメントは利用できません。

　

### gs_shの終了

gs_shを終了します。

- サブコマンド

  | |
  |-|
  | exit<br>quit |

- 例)

  ``` example
  //gs_shを終了します。
  gs> exit
  ```

また、サブコマンドでエラーが発生した場合に、gs_shを終了するように設定できます。

- サブコマンド

  | |
  |-|
  | errexit boolean |

- 引数

  | 引数    | 説明                                                                                                         |
  |---------|--------------------------------------------------------------------------------------------------------------|
  | boolean | TRUEを指定すると、サブコマンドでエラーが発生した場合に、gs_shが終了します。デフォルトはFALSEです。 |

- 例)

  ``` example
  //サブコマンドでエラーが発生した場合にgs_shが終了するように設定
  gs> errexit TRUE
  ```

【メモ】
- exitサブコマンド、quitサブコマンドに機能差はありません。

　

### ヘルプ

サブコマンドの説明を表示します。

- サブコマンド

  | |
  |-|
  | help \[サブコマンド名\] |

- 引数

  | 引数           | 説明                                                                                     |
  |----------------|------------------------------------------------------------------------------------------|
  | サブコマンド名 | 説明を表示するサブコマンド名を指定します。省略した場合、サブコマンドの一覧を表示します。 |

- 例)

  ``` example
  //サブコマンドの説明表示
  gs> help exit
  exit
  gs_shを終了します。
  ```

【メモ】
- gs_shの説明は、「gs_sh　--help」で取得できます。

　

### バージョン

gs_shのバージョンを表示します。

- サブコマンド

  | |
  |-|
  | version |

- 例)

  ``` example
  //バージョンの表示
  gs> version
  gs_sh version 2.0.0
  ```

【メモ】
- gs_shのバージョン情報は、「gs_sh --version」でも取得できます。



### タイムゾーン設定

タイムゾーンの設定を行います。

- サブコマンド

  | |
  |-|
  | settimezone \[設定値\] |

- 引数

  | 引数           | 説明                                                                                     |
  |----------------|------------------------------------------------------------------------------------------|
  | 設定値 | 設定値の形式は「±hh:mm」「±hhmm」「Z」「auto」です。例えば、日本時間の場合、設定値は「+09:00」です。<br>値が未設定の場合、タイムゾーンの設定値をクリアします。 |

【メモ】
- connectサブコマンド実行後に、settimezoneサブコマンドでタイムゾーン設定を変更した場合、変更後のタイムゾーン設定は再度、connectサブコマンドを実行するまで反映されません。タイムゾーン設定変更を行った後には再度、connectサブコマンドを実行してください。

### 履歴表示と実行

実行したサブコマンドの履歴を表示します。

- サブコマンド

  | |
  |-|
  | history |

historyサブコマンドで表示した履歴よりサブコマンドを再実行します。

- サブコマンド

  | |
  |-|
  |!履歴番号|

- 引数

  | 引数           | 説明                                                                                     |
  |----------------|------------------------------------------------------------------------------------------|
  | 履歴番号 | historyサブコマンドで表示した履歴より、再実行したいサブコマンドを番号で指定します。|

直前に実行したサブコマンドを再実行します。

- サブコマンド

  | |
  |-|
  |!!|


- 例)

  ``` example
  gs> history
  　1  connect $mycluster
  　2  showcontainer
  　3  select * from mytable;
  　:
  　210  configcluster $mycluster
  　211  history

  gs> !210
  gs> configcluster $mycluster
             :

  gs> !!
  gs> configcluster $mycluster
             :
  
  ```

【メモ】
- 表示できる履歴の最大数は500までです。



## オプション・サブコマンド仕様

### オプション

- コマンド一覧

  | |
  |-|
  | gs_sh \[スクリプトファイル\] |
  | gs_sh -v \| --version         |
  | gs_sh -h \| --help           |

- オプション仕様

  | オプション    | 必須 | 説明                                             |
  |---------------|------|--------------------------------------------------|
  | -v \| --version |      | ツールのバージョンを表示します。                 |
  | -h \| --help    |      | ヘルプメッセージとしてコマンド一覧を表示します。 |

【メモ】
- gs_shサブコマンドをバッチ処理するために、スクリプトファイルが作成できます。スクリプトファイルの拡張子はgshです。
- gs_sh起動時に、gsadmユーザホームディレクトリ下の.gsshrcスクリプトファイルを自動的に読み込みます。.gsshrcの内容は、他のスクリプトファイルよりも先に読み込みます。

　

### サブコマンド一覧

- GridDBクラスタ定義　サブコマンド一覧

  | サブコマンド   | 引数                                   | 説明                                                       | \*1 |
  |---------------|----------------------------------------|------------------------------------------------------------|-----|
  | setnode       | ノード変数名 IPアドレス ポート番号 \[SSHポート番号\]      | ノード変数を定義します。                          |     |
  | setcluster    | クラスタ変数名 クラスタ名 マルチキャストアドレス　ポート番号 \[ノード変数... \]   | クラスタ変数を定義します。  |     |
  | setclustersql | クラスタ変数名 クラスタ名 SQLアドレス　SQLポート番号  | クラスタ構成にSQLの接続先を定義します。                |     |
  | modcluster 　 | クラスタ変数名 add\|remove　ノード変数...           | クラスタ変数に対してノード変数を追加、削除します。             |     |
  | setuser       | ユーザ名 パスワード \[OSユーザgsadmのパスワード\]   | クラスタにアクセスするユーザおよびパスワードを定義します。 |     |
  | set           | 変数名　\[値\]                       | 任意の変数を定義します。                                            |     |
  | show          | \[変数名\]                           | 変数の定義内容を表示します。                                         |     |
  | save          | \[スクリプトファイル名\]             | 変数定義をスクリプトファイルに保存します。                             |     |
  | load          | \[スクリプトファイル名\]             | スクリプトファイルを読み込み、実行します。                               | 　 |
  | sync          | IPアドレス ポート番号　\[クラスタ変数名 \[ノード変数\] \]              | 稼働中のGridDBクラスタに接続し、クラスタ変数とノード変数定義を自動で行います。                               | \*　 |

  - \*1 : \*は、管理ユーザのみ実行可能なコマンドです。


- GridDBクラスタ操作　サブコマンド一覧

  | サブコマンド          | 引数                                               | 説明                                           | \*1 |
  |-----------------------|----------------------------------------------------|----------------------------------------------|-----|
  | showsql           | [クエリID]                                         | 実行中のSQL処理を表示します。                         |   |
  | showevent         |                                                    | 実行中のイベント一覧を表示します。                    |   |
  | showconnection    |                                                    | コネクションの一覧を表示します。                      |   |
  | killsql           | クエリID                                           | 実行中のSQL処理をキャンセルします。                   | \* |

  - \*1 : \*は、管理ユーザのみ実行可能なコマンドです。

　

- データベース内データ操作　サブコマンド一覧

  | サブコマンド | 引数                           | 説明                                                   | \*1 |
  |------------|---------------------------------|------------------------------------------------------|-----|
  | connect    | クラスタ変数 \[データベース名\]   | GridDBクラスタに接続します。                                 |     |
  | tql        | コンテナ名　クエリ　;            | 検索を実行し、検索結果を保持します。                         |     |
  | get        | \[ 取得件数 \]                  | 検索結果を取得し、標準出力に表示します。                    |     |
  | getcsv     | CSVファイル名　\[ 取得件数 \]    | 検索結果を取得し、CSV形式でファイルに保存します。             |     |
  | getnoprint | \[ 取得件数 \]                  | クエリの結果を取得しますが、標準出力に表示しません。          |     |
  | tqlclose   |                                 | TQLをクローズし、保持する検索結果を破棄します。               |     |
  | tqlexplain | コンテナ名　クエリ　;            | 指定TQL文の実行計画を表示します。                            |     |
  | tqlanalyze | コンテナ名　クエリ　;            | 指定TQL文を実行し、実行計画と処理件数等の実測値を表示します。   |     |
  | sql        | SQL文　;                        | SQL文を実行し、検索結果を保持します。                       |     |
  | sqlcount   | boolean                         | SQLの検索実行時、件数取得処理を実行するかどうかを設定します。 |     |
  | queryclose |                                 | クエリをクローズし、保持する検索結果を破棄します。            |     |
  | disconnect |                                 | GridDBクラスタから切断します。                             |   　  |

  - \*1 : \*は、管理ユーザのみ実行可能なコマンドです。

　

- コンテナ管理　サブコマンド一覧

  | サブコマンド      | 引数                                                   | 説明                                           | \*1 |
  |------------------|--------------------------------------------------------|------------------------------------------------|-----|
  | createcollection | コンテナ名 カラム名　タイプ \[カラム名　タイプ …\]         | コンテナ(コレクション)を作成します。           |     |
  | createtimeseries | コンテナ名 圧縮方式 カラム名　タイプ \[カラム名　タイプ …\] | コンテナ(時系列コンテナ)を作成します。         |     |
  | dropcontainer    | コンテナ名                                              | コンテナを削除します。                         |     |
  | putrow          | コンテナ名 値 [値...]              | コンテナにロウを登録します。    | 　 |
  | removerow          | コンテナ名 ロウキー値 [ロウキー値...]   | コンテナのロウを削除します。        | 　 |
  | showcontainer    | \[ コンテナ名 \]                                        | コンテナ情報を表示します。                     |     |
  | showtable        | \[ テーブル名 \]                                        | テーブル情報を表示します。                     |     |
  | searchcontainer   | \[コンテナ名\] | コンテナ名からコンテナを検索します。    | 　 |
  | searchview       | \[ビュー名\]   | ビュー名からビューを検索します。  | 　 |
  | createindex      | コンテナ名　カラム名　索引タイプ...                       | 指定カラムに索引を作成します。                 |     |
  | createcompindex  | コンテナ名　カラム名...                                  | 指定カラムに複合索引を作成します。             |     |
  | dropindex        | コンテナ名　カラム名　索引タイプ...                       | 指定カラムの索引を削除します。                 |     |
  | dropcompindex    | コンテナ名　カラム名...                                  | 指定カラムの複合索引を削除します。               |     |
  | droptrigger      | コンテナ名　トリガ名                                     | トリガ情報を削除します。                       |     |
  | showtrigger      | コンテナ名　\[ トリガ名 \]                               | トリガ情報を表示します。                       |     |

  - \*1 : \*は、管理ユーザのみ実行可能なコマンドです。

　

- 実行計画　サブコマンド一覧

  | サブコマンド      | 引数                                                   | 説明                                          | \*1 |
  |------------------|--------------------------------------------------------|------------------------------------------------|-----|
  | getplantxt       | [テキストファイル名]                                   | SQL分析結果をテキスト形式で表示します。        |     |
  | getplanjson      | [JSONファイル名]                                       | SQL分析結果をJSON形式で表示します。            |     |
  | gettaskplan      | プランID                                               | SQL分析結果の詳細情報をJSON形式で表示します。  |     |

  - \*1 : \*は、管理ユーザのみ実行可能なコマンドです。

　

- その他の操作　サブコマンド一覧

  | サブコマンド | 引数                              | 説明                                              | \*1 |
  |----------|--------------------------------------|--------------------------------------------------|-----|
  | echo     | boolean                              | エコーバックの有無を設定します。                    |     |
  | print    | メッセージ                            | 指定した文字列、もしくは変数の定義内容を表示します。  |     |
  | sleep    | 秒数                                 | 指定した秒数スリープします。                        |     |
  | exec     | 外部コマンド　\[ 外部コマンド引数 \] | 外部コマンドを実行します。                            |     |
  | exit     |                                      | gs_shを終了します。                               |     |
  | quit     |                                      | gs_shを終了します。                               |     |
  | errexit  | boolean                              | エラー発生時にgs_shを終了するかを設定します。        |     |
  | help     | \[ サブコマンド名 \]                  | サブコマンドの説明を表示します。                    |     |
  | version  |                                      | バージョン情報を表示します。                       |     |
  | settimezone  | \[ 設定値 \]                        | タイムゾーンの設定を行います。                      |     |
  | history |  | 実行したサブコマンドの履歴を表示します。 |   |
  | !\[ 履歴番号 \] |   | historyサブコマンドで表示した履歴よりサブコマンドを再実行します。 |   |
  | !! |  |直前に実行したサブコマンドを再実行します。 |   |

  - \*1 : \*は、管理ユーザのみ実行可能なコマンドです。
